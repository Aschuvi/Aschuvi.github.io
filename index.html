<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Aschuvi - l'hstoire d'une patate</title>
        
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/stylesheet.css" >
        
        <script src="js/jquery-2.1.4.min.js" type="text/javascript"></script>
        <script src="js/bootstrap.min.js" type="text/javascript"></script>
    </head>
    <body>
<!-- HEADER ------------------------------------------------------------------------------------->
        <header>
            <div id="site-identity" onclick="window.location.href='home.html'">
                <img src="img/logo.png">
                <span>l'hisoire d'une patate</span>
            </div>
            <div id="nav">
                <div class="nav-container">
                    <a href="javascript:void(0)">Home</a>
                    <span class="bottom-bar"></span>
                </div>
                <!--
                <span class="nav-separator"></span>
                <div class="nav-container">
                    <a href="javascript:void(0)">Archives</a>
                    <span class="bottom-bar"></span>
                </div>-->
                <span class="nav-separator"></span>
                <div class="nav-container">
                    <a href="about.html">A propos</a>
                    <span class="bottom-bar"></span>
                </div>
                <span class="nav-separator"></span>
                <div class="nav-container">
                    <a href="faq.html">FAQ</a>
                    <span class="bottom-bar"></span>
                </div>
            </div>
            <div id="search">
                <div class="img-container">
                    <img src="img/potatoStory/search-button.svg">
                </div>
                <div id="input-search">
                    <span id="left-bar"></span>
                    <input type="text" id="searchBar">
                    <span class="input-bar"></span>
                </div>
            </div>
        </header>
<!-- PAGE --------------------------------------------------------------------------------------->
        <div id="page">
            <div id="container" class="container">
<!-- LEFT COLUMN -------------------------------------------------------------------------------->
                <div id="feed" class="lg-8 md-8 xs-12">
                    <!--<div class="post">
                        <div class="post-banner">
                        </div>
                        <div>
                            <div class="post-header">
                                <a href="article.html">To you...</a>
                                <p class="post-legend">
                                    <span class="type">Histoire</span>
                                    <span class="author">Aschuvi</span>
                                    <span class="date">21 Juillet 2016</span>
                                </p>
                            </div>
                        </div>
                        <img class="post-logo" src="img/calvinAndHobbes-grownUp_2.png">
                        <div class="post-desc">
                            Alors me voila, en train de me réveiller après avoir passé une soirée avec une amie que je n’avais pas vue depuis 1 an ! Une amie que tu connais très bien, Mathilde. On s’est parlé de pleins de trucs, de tout de rien, j’ai passé un super moment. Comme tout[...]
                        </div>
                    </div>
                    <div class="post">
                        <div>
                            <div class="post-desc" id="charger-suivant">
                                Load More
                            </div>
                        </div>
                    </div>-->
                </div>
<!-- RIGHT COLUMN ------------------------------------------------------------------------------->
                <div class="lg-4 md-4 xs-12">
                    <div class="post no-img">
                        <div class="post-header">
                            <h1>Hey !</h1>
                            <!-- <span class="separator"></span> -->
                        </div>
                        <p class="post-desc">
                            Ce site est la pour se détendre. J'éspère que ça te permettra de t'évader 10 minutes et si possible, de te faire esquisser un sourire.<br />
                            J'aime parler, je suis bavard, et j'écris comme je parle (en gros !).<br />
                            Passe un bon moment ;)
                        </p>
                    </div>
                    <div class="post no-img">
                        <div class="post-header">
                            <h1>Contact</h1>
                        </div>
                        <div class="post-desc">
                            Je vais bientot créer une page facebook pour rendre la communication plus facile mais en attendant tu peux me contacter à <a href="mailto:potatostory@gmail.com">potatostory@gmail.com</a>
                        </div>
                    </div>
                    <div class="post no-img">
                        <div class="post-header">
                            <h1>Archives</h1>
                        </div>
                        <div class="post-desc-menu">
                            <div id="archive" class="archive-list">
                                <!--
                                <div class="archive-list-item-container">
                                    <div class="archive-list-item">
                                        <p class="archive-item-title">2016 (7)</p>
                                    </div>
                                    <div class="archive-article-list">
                                        <p class="archive-article-item">Article</p>
                                        <p class="archive-article-item">Bidule</p>
                                        <p class="archive-article-item">Truc</p>
                                        <p class="archive-article-item">Machin</p>
                                        <p class="archive-article-item">Playmobile</p>
                                        <p class="archive-article-item">Batman</p>
                                        <p class="archive-article-item">Mensonge</p>
                                    </div>
                                </div>

                                <div class="archive-list-item-container">
                                    <div class="archive-list-item">
                                        <p class="archive-item-title">2015 (3)</p>
                                    </div>
                                    <div class="archive-article-list">
                                        <p class="archive-article-item">Lâcheté</p>
                                        <p class="archive-article-item">Carte Postale</p>
                                        <p class="archive-article-item">To You...</p>
                                    </div>
                                </div>

                                <div class="archive-list-item-container">
                                    <div class="archive-list-item">
                                        <p class="archive-item-title">2014 (1)</p>
                                    </div>
                                    <div class="archive-article-list">
                                        <p class="archive-article-item">Mon idée</p>
                                    </div>
                                </div>

                                <div class="archive-list-item-container">
                                    <div class="archive-list-item">
                                        <p class="archive-item-title">2013 (5)</p>
                                    </div>
                                    <div id="test" class="archive-article-list">
                                        <p class="archive-article-item">Le test</p>
                                        <p class="archive-article-item">Francheluche</p>
                                        <p class="archive-article-item">Your Song</p>
                                        <p class="archive-article-item">L'esquive</p>
                                        <p class="archive-article-item">Escarmouche</p>
                                    </div>
                                </div>-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer></footer>
        <script type="text/javascript">
            var nullSearch = true;
            var artPointer = 0;
            
            // build the HTML code of the articles
            var buildArticle = function(article) {
                var buildA = "";
                buildA += '<div class="post">';
                buildA += '<div class="post-banner" style="background-image: url(\'img/pictures/'+article.bgImg+'\')"></div>';
                buildA += '<div>';
                buildA += '<div class="post-header">';
                buildA += '<a href="post.html?id='+article.id+'">' + article.title +'</a>';
                buildA += '<p class="post-legend">';
                buildA += '<span class="type">' + article.type + '</span>';
                buildA += '<span class="author">' + article.author + '</span>';
                buildA += '<span class="date">' + article.date + '</span>';
                buildA += '</p></div></div><img class="post-logo" src="img/pictures/calvinAndHobbes-grownUp_2.png"><div class="post-desc">';
                buildA += article.content.substring(0,255) + '[...]' + '</p></div></div>';
                
                return buildA;
            }
            
            // build the html code for the archives
            var buildArchives = function() {
                $.getJSON("resources/datas.json", function() {
                })
                .done(function(d) {
                    var mapArchive = new Map();
                    $.each(d.articles, function(i, article) {
                        var date = article.date.slice(-4);
                        if(mapArchive.has(date)) {
                            mapArchive.get(date).push(article);
                        } else {
                            mapArchive.set(date, new Array(article));
                        }
                    });

                    var buildArch = '';
                    for (var [clé, valeur] of mapArchive) {
                        buildArch += '<div class="archive-list-item-container">';
                        buildArch += '<div class="archive-list-item">';
                        buildArch += '<p class="archive-item-title">'+clé+' ('+ valeur.length +')</p>';
                        buildArch += '</div>';
                        buildArch += '<div class="archive-article-list">';
                        for(var iVal = 0; iVal<valeur.length; iVal++) {
                            buildArch += '<a class="archive-article-item" href="post.html?id='+valeur[iVal].id+'">'+valeur[iVal].title+'</a>';
                        }
                        buildArch += '</div>';
                        buildArch += '</div>';
                    }
                    $("#archive").append(buildArch);
                    
                    
            
                    $(".archive-item-title").click(function() {
                        var container = $(this).closest(".archive-list-item-container");
                        $("#archive .archive-list-item-container.focus .archive-article-list").height(0);
                        if(container.hasClass("focus")) {
                            container.removeClass("focus");
                        } else {
                            $(".archive-list-item-container").removeClass("focus");
                            container.addClass("focus");
                            container.children(".archive-article-list").height(container.find(".archive-article-item").length * container.find(".archive-article-item").height());
                        }
                    });
                });
            }
            
            // build the html code for the button "load more"
            var addLoadNextSection = function() {
                $("loadNextPost").remove();
                var chargerSuivant = '<div class="post" id="loadNextPost">';
                    chargerSuivant += '<div>';
                    chargerSuivant += '<div class="post-desc" id="charger-suivant" onclick="loadNextArticles()">Load More</div></div></div>';
                $("#feed").append(chargerSuivant);
            }
            
            // get the next 10 articles
            var loadNextArticles = function() {
                $.getJSON("resources/datas.json", function() {
                })
                    .done(function(d) {
                        var len = d.articles.length;
                        $.each(d.articles, function(i, article) {
                            if(i==artPointer+10) {
                                addLoadNextSection();
                                artPointer += 10;
                                return false;
                            }
                            else if(i>=artPointer) {
                                $("#feed").append(buildArticle(article));
                                if(i == len-1) {
                                    $("#loadNextPost").remove();
                                }
                            }
                        });
                    });
            }
            
            // search the articles
            var researchAll = function(terms) {
                $.getJSON("resources/datas.json", function() {
                })
                    .done(function(d) {
                        $("#feed").empty();
                        terms = terms.toLowerCase();
                        $.each(d.articles, function(i, article) {
                            if(article.title.toLowerCase().search(terms) != -1 || article.type.toLowerCase().search(terms) != -1 || article.author.toLowerCase().search(terms) != -1 || article.date.toLowerCase().search(terms) != -1 || article.content.toLowerCase().search(terms) != -1)
                                $("#feed").append(buildArticle(article));
                        });
                    });
            }
            
            // init the page
            $(document).ready(function() {
                loadNextArticles();
                buildArchives();
            });
            
            // js code for the search bar
            $("#search .img-container").click(function() {
                var input = $("#search");
                if(input.hasClass("deployed")) {
                    input.removeClass("deployed");
                    $("#input-search").removeClass("deployed");
                }
                else {
                    input.addClass("deployed");
                    $("#input-search").addClass("deployed");
                    $("#searchBar").focus();
                }
            });
            
            $("#searchBar").keypress(function(e) {                
                // if enter or spaceBar is pressed
                if((e.which == 13 || e.which == 32) && $(this).val().length >= 3) {
                    researchAll($(this).val());
                    nullSearch = false;
                }
                if(!nullSearch && ($(this).val() == null || $(this).val().length == 0) ) {
                    nullSearch = true;
                    $("#feed").empty();
                    loadNextArticles(0);
                }
            });

        </script>
	</body>
</html>